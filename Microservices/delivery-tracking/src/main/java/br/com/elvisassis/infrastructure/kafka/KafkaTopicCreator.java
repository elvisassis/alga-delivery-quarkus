package br.com.elvisassis.infrastructure.kafka;import jakarta.enterprise.context.ApplicationScoped;import jakarta.annotation.PostConstruct;import org.apache.kafka.clients.admin.AdminClient;import org.apache.kafka.clients.admin.ListTopicsOptions;import org.apache.kafka.clients.admin.NewTopic;import org.eclipse.microprofile.config.inject.ConfigProperty;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.util.List;import java.util.Properties;import java.util.Set;import java.util.stream.Collectors;@ApplicationScopedpublic class KafkaTopicCreator {    private static final Logger log = LoggerFactory.getLogger(KafkaTopicCreator.class);    @ConfigProperty(name = "kafka.bootstrap.servers")    String bootstrapServers;    @ConfigProperty(name = "topics.list")    List<TopicConfig> topics;    @ConfigProperty(name = "topics.auto-create", defaultValue = "false")    boolean autoCreate;    @PostConstruct    void init() {        if (autoCreate) {            createTopicsSafely();        } else {            log.info("Topic auto-creation is disabled for this profile.");        }    }    private void createTopicsSafely() {        Properties props = new Properties();        props.put("bootstrap.servers", bootstrapServers);        try (AdminClient adminClient = AdminClient.create(props)) {            // Lista tópicos existentes            Set<String> existingTopics = adminClient.listTopics(new ListTopicsOptions().listInternal(false))                    .names()                    .get();            // Filtra apenas tópicos que ainda não existem            List<NewTopic> newTopics = topics.stream()                    .filter(t -> !existingTopics.contains(t.getName()))                    .map(t -> new NewTopic(t.getName(), t.getPartitions(), t.getReplicas()))                    .collect(Collectors.toList());            if (!newTopics.isEmpty()) {                adminClient.createTopics(newTopics).all()                        .whenComplete((r, ex) -> {                            if (ex != null) {                                log.info("Error creating topics:  {}", ex.getMessage());                            } else {                                log.info("Topics created: {}", newTopics.stream().map(NewTopic::name).collect(Collectors.joining(", ")));                            }                        });            } else {                log.info("All topics already exist. No topics created.");            }        } catch (Exception e) {            log.info("Error checking/creating topics: {}", e.getMessage());        }    }}